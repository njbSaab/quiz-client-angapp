import{a as y}from"./chunk-ZA5DLN47.js";import{d as u,h as a,i as g,l as d,o as h,r as f,wa as I,xa as v}from"./chunk-LQ3NOQTV.js";var n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function w(e,r=0){return(n[e[r+0]]+n[e[r+1]]+n[e[r+2]]+n[e[r+3]]+"-"+n[e[r+4]]+n[e[r+5]]+"-"+n[e[r+6]]+n[e[r+7]]+"-"+n[e[r+8]]+n[e[r+9]]+"-"+n[e[r+10]]+n[e[r+11]]+n[e[r+12]]+n[e[r+13]]+n[e[r+14]]+n[e[r+15]]).toLowerCase()}var l,x=new Uint8Array(16);function p(){if(!l){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(x)}var U=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),c={randomUUID:U};function S(e,r,t){e=e||{};let o=e.random??e.rng?.()??p();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,r){if(t=t||0,t<0||t+16>r.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let s=0;s<16;++s)r[t+s]=o[s];return r}return w(o)}function b(e,r,t){return c.randomUUID&&!r&&!e?c.randomUUID():S(e,r,t)}var m=b;var Z=(()=>{class e{http;apiUrl=y.apiUrl;sessionId=null;constructor(t){this.http=t,this.sessionId=localStorage.getItem("sessionId")||null,this.sessionId||(this.sessionId=m(),localStorage.setItem("sessionId",this.sessionId))}getHeaders(){return new I({"X-Secret-Word":"TOPWINNER_TOP_QUIZWIZ_WORLD"})}getSessionId(){return this.sessionId}saveUserSession(t){return t.sessionId=this.sessionId,this.http.post(`${this.apiUrl}/users/session`,t,{headers:this.getHeaders()}).pipe(g(o=>(this.sessionId=o.session?.sessionId||this.sessionId,localStorage.setItem("sessionId",this.sessionId),o)),d(o=>(console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u0441\u0435\u0441\u0441\u0438\u0438:",o),a(null))))}addUserResult(t){return t.sessionId=this.sessionId,this.http.post(`${this.apiUrl}/quizzes/${t.quizId}/submit`,t,{headers:this.getHeaders()}).pipe(d(o=>(console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432:",o),a(null))))}addUser(t){let o={name:t.name,email:t.email,sessionId:this.sessionId};return this.http.post(`${this.apiUrl}/users`,o,{headers:this.getHeaders()}).pipe(d(s=>(console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F:",s),a(null))))}collectBrowserInfo(){return u(this,null,function*(){let t=yield this.getIpAddress(),o;if(navigator.geolocation)try{o=yield new Promise((s,D)=>{navigator.geolocation.getCurrentPosition(i=>s({latitude:i.coords.latitude,longitude:i.coords.longitude}),i=>{console.warn("\u0413\u0435\u043E\u043B\u043E\u043A\u0430\u0446\u0438\u044F \u043D\u0435 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0430:",i),s(void 0)})})}catch(s){console.warn("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0433\u0435\u043E\u043B\u043E\u043A\u0430\u0446\u0438\u0438:",s)}return{userAgent:navigator.userAgent,language:navigator.language,screen:{width:window.screen.width,height:window.screen.height},timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookiesEnabled:navigator.cookieEnabled,platform:navigator.platform,referrer:document.referrer,ipAddress:t,geolocation:o}})}getIpAddress(){return u(this,null,function*(){try{return(yield(yield fetch("https://api.ipify.org?format=json")).json()).ip}catch(t){console.warn("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C IP:",t);return}})}clearSession(){this.sessionId=null,localStorage.removeItem("sessionId")}static \u0275fac=function(o){return new(o||e)(f(v))};static \u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();export{Z as a};
